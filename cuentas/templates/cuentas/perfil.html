{% extends "Main/base.html" %}
{% load static %}

{% block title %}
Perfil de {{ user.username }}
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="card p-4 shadow-lg border-0 rounded-4">

    <div class="row mb-4">

      <div class="col-md-4 text-center">
        <div class="mb-3">
          {% if user.avatar %}
          <img src="{{ user.avatar.imagen.url }}" alt="Avatar de {{ user.username }}"
            class="img-thumbnail rounded-circle shadow-sm" style="width: 150px; height: 150px; object-fit: cover;">
          {% else %}
          <img src="{% static 'images/avatar_default.png' %}" alt="Avatar por defecto"
            class="img-thumbnail rounded-circle" style="width: 150px;">
          {% endif %}
          <a href="{% url 'cuentas:subir-avatar' %}" class="d-block mt-2">Cambiar avatar</a>
        </div>

        <hr>

        <h3 class="text-primary fw-bold">{{ user.username }}</h3>
        <p class="text-muted mb-3">Miembro desde {{ user.date_joined|date:"d/m/Y" }}</p>
        <hr>
        <p><strong>Nombre completo:</strong> {{ user.first_name }} {{ user.last_name }}</p>
        <p><strong>Correo:</strong> {{ user.email }}</p>


      </div>

      <div class="col-md-8">
        {% if user.pokemon_favorito %}
        <div class="mt-4 d-flex align-items-center justify-content-around shadow-sm"
          style="border: solid rgba(156, 160, 88, 0.531) 1px" ;">
          <div>
            <h5 class="fw-bold text-secondary">‚≠ê Pok√©mon Favorito</h5>

          </div>
          <div>
            <button type="button" class="btn btn-link p-0" data-bs-toggle="modal"
              data-bs-target="#modalPokemonFavorito">
              <p class="mb-1 focus-ring-danger">{{ user.pokemon_favorito.nombre }}</p>
            </button>
            <img src="{{ user.pokemon_favorito.imagen_frente.url }}" alt="{{ user.pokemon_favorito.nombre }}"
              class="img-fluid rounded" style="max-width:80px;">
          </div>
        </div>
        {% else %}
        <p class="text-center text-muted"><em>No tiene Pok√©mon favorito seleccionado.</em></p>
        {% endif %}
        <div class="mt-4">
          <br>
          <h5 class="fw-bold text-secondary mb-3">üìä Estad√≠sticas de Combates</h5>

          <div class="row text-center align-items-center">
            <div class="col-12 col-md-12 mb-2">
              <div class="card border-info border-2 shadow-sm">
                <div class="card-body">
                  <h6 class="text-info">Jugados</h6>
                  <span class="badge bg-info fs-5">{{ user.combates_jugados }}</span>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-4 mb-2 ">
              <div class="card border-success border-2 shadow-sm">
                <div class="card-body">
                  <h6 class="text-success">Ganados</h6>
                  <span class="badge bg-success fs-5">{{ user.combates_ganados }}</span>
                </div>
              </div>
            </div>
             <div class="col-12 col-md-4 mb-2 ">
              <div class="card border-warning border-2 shadow-sm">
                <div class="card-body">  
                  <h6 class="text-warning ">Empatados</h6>
                  <span class="badge bg-warning fs-5">{{ user.combates_empatados }}</span>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-4 mb-2 ">
              <div class="card border-danger border-2 shadow-sm">
                <div class="card-body">
                  <h6 class="text-danger">Perdidos</h6>
                  <span class="badge bg-danger fs-5">{{ user.combates_perdidos }}</span>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <hr>

    {% if user.pokemon_favorito %}
    <div class="modal fade" id="modalPokemonFavorito" tabindex="-1" aria-labelledby="modalPokemonLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded-4 shadow-lg">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title" id="modalPokemonLabel">{{ user.pokemon_favorito.nombre }}</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
              aria-label="Cerrar"></button>
          </div>
          <div class="modal-body text-center">
            <img src="{{ user.pokemon_favorito.imagen_frente.url }}" alt="{{ user.pokemon_favorito.nombre }}"
              class="img-fluid mb-3" style="max-width:120px;">
            <img src="{{ user.pokemon_favorito.imagen_espalda.url }}" alt="{{ user.pokemon_favorito.nombre }}"
              class="img-fluid mb-3" style="max-width:120px;">
            <p><strong>N√∫mero:</strong> {{ user.pokemon_favorito.numero }}</p>
            <p><strong>Tipo:</strong> {{ user.pokemon_favorito.tipo }}</p>
            <p><strong>Debilidad:</strong> {{ user.pokemon_favorito.debilidad }}</p>
            <p><strong>Ataques:</strong> {{ user.pokemon_favorito.ataque1 }} / {{ user.pokemon_favorito.ataque2 }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <a href="{% url 'pokedex:detalle_pokemon' user.pokemon_favorito.pk %}" class="btn btn-primary">Ver en
              Pokedex</a>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="text-center mt-4">
      <form method="post" action="{% url 'cuentas:logout' %}">
        {% csrf_token %}
        <a href="{% url 'cuentas:editar-perfil' %}" class="btn btn-warning me-2">Editar perfil</a>
        <button type="submit" class="btn btn-danger me-2">Cerrar sesi√≥n</button>
        <a href="{% url 'pokedex:list_pokemon' %}" class="btn btn-secondary">Cancelar</a>
      </form>
    </div>

  </div>
</div>
{% endblock %}