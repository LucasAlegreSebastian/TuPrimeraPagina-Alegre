{% extends 'Main/base.html' %}
{% block title %}Combate - Turno {{ estado.turno_actual }}{% endblock %}

{% block content %}
<div class="container text-center mt-4">
    <h2>¡Combate Pokémon!</h2>

    <div style="display:flex; justify-content:space-around; align-items:center; margin-top:30px;">
        <div>
            <h3>{{ pokemon_usuario.nombre }}</h3>
            <img src="{{ pokemon_usuario.imagen_espalda.url }}" width="80">
            <p>HP: <strong>{{ estado.hp_usuario|floatformat:0 }} / 100</strong></p>
        </div>
        
        <h2>VS</h2>
        
        <div>
            <h3>{{ pokemon_enemigo.nombre }}</h3>
            <img src="{{ pokemon_enemigo.imagen_frente.url }}" width="80">
            <p>HP: <strong>{{ estado.hp_enemigo|floatformat:0 }} / 100</strong></p>
        </div>
    </div>

    <hr>
    
    <h4>Turno Actual: {{ estado.turno_actual }} de {{ estado.max_turnos }}</h4>

    {% if estado.log_turnos %}
        <div class="alert alert-info mt-3" role="alert">
            <strong>Último Movimiento:</strong> {{ estado.log_turnos|last }}
        </div>
    {% else %}
        <p class="mt-3">La batalla está por comenzar...</p>
    {% endif %}

    <form method="post" action="{% url 'combate:turno' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-lg btn-success mt-4">
            Siguiente Turno (Atacar)
        </button>
    </form>
    
   

</div>
<script>
    // Seleccionamos el formulario y el botón
    const formTurno = document.getElementById('form-turno');
    const btnTurno = document.getElementById('btn-turno');
    
    // Función para manejar el clic en el botón
    formTurno.addEventListener('submit', function(event) {
        // 1. Previene el envío inmediato del formulario.
        event.preventDefault(); 
        
        // 2. Deshabilita el botón para evitar clics múltiples
        btnTurno.disabled = true;
        btnTurno.textContent = "Calculando turno..."; 
        
        // 3. Temporizador (setTimeout)
        // Ejecuta la función interna después de 2000 milisegundos (2 segundos)
        setTimeout(() => {
            // Re-habilita y envía el formulario al servidor de Django
            formTurno.submit();
        }, 5000); // <-- Aquí ajustas el tiempo de espera en milisegundos (2000ms = 2s)
    });
</script>
{% endblock %}